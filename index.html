<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Mic ‚Üí PCD (Ring + Tuning Needle + Reactivity)</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <button id="start">Start mic</button>
    <button id="stop" disabled>Stop</button>
    <button id="resetRot" title="Reset ring rotation">Reset ring</button>
    <span id="status">Idle</span>
  </header>

  <details class="settings">
    <summary><strong>Settings</strong> ‚öôÔ∏è</summary>
    
    <!-- AUDIO PROCESSING SECTION -->
    <h4 style="margin:16px 0 8px 0; opacity:0.8; border-bottom:1px solid color-mix(in oklab, currentColor 20%, transparent); padding-bottom:4px;">üîä Audio Processing</h4>
    <div class="row">
      <label for="windowRange">Window Size</label>
      <input id="windowRange" type="range" min="11" max="16" step="1" value="14">
      <span id="windowVal">16384</span>
      <small>FFT window (2^n samples, larger = better freq resolution)</small>
    </div>
    <div class="row">
      <label for="hopRange">Hop Size</label>
      <input id="hopRange" type="range" min="8" max="14" step="1" value="10">
      <span id="hopVal">1024</span>
      <small>analysis hop (2^n samples, smaller = more updates)</small>
    </div>
    <div class="row">
      <label for="minHzRange">Min Freq (Hz)</label>
      <input id="minHzRange" type="range" min="20" max="200" step="5" value="50">
      <span id="minHzVal">50 Hz</span>
      <small>lowest frequency to analyze</small>
    </div>
    <div class="row">
      <label for="maxHzRange">Max Freq (Hz)</label>
      <input id="maxHzRange" type="range" min="1000" max="8000" step="100" value="5000">
      <span id="maxHzVal">5000 Hz</span>
      <small>highest frequency to analyze</small>
    </div>
    <div class="row">
      <label for="refA4Input">Reference A4</label>
      <input id="refA4Input" type="number" min="400" max="480" step="0.1" value="440.0" style="width:80px; padding:6px 8px; border-radius:6px; border:1px solid #888; background:transparent; color:currentColor;">
      <span style="opacity:0.7">Hz</span>
      <small>tuning reference (baroque=415, concert=440, etc.)</small>
    </div>
    
    <!-- PCD PROCESSING SECTION -->
    <h4 style="margin:16px 0 8px 0; opacity:0.8; border-bottom:1px solid color-mix(in oklab, currentColor 20%, transparent); padding-bottom:4px;">üìä PCD Processing</h4>
    <div class="row">
      <label for="pcdRmsRange">PCD Min RMS</label>
      <input id="pcdRmsRange" type="range" min="0" max="0.01" step="0.0001" value="0.001">
      <span id="pcdRmsVal">0.0010</span>
      <small>minimum signal level for PCD calculation</small>
    </div>
    <div class="row">
      <label for="pcdThreshRange">PCD Threshold</label>
      <input id="pcdThreshRange" type="range" min="0" max="0.1" step="0.001" value="0.005">
      <span id="pcdThreshVal">0.005</span>
      <small>minimum magnitude to include in PCD</small>
    </div>
    <div class="row">
      <label for="smoothRange">PCD Smoothing</label>
      <input id="smoothRange" type="range" min="0.1" max="0.9" step="0.05" value="0.6">
      <span id="smoothVal">0.60</span>
      <small>temporal smoothing (0.1=reactive, 0.9=smooth)</small>
    </div>
    <div class="row">
      <label for="pcdNormRange">PCD Normalize</label>
      <input id="pcdNormRange" type="range" min="0.5" max="3.0" step="0.1" value="1.0">
      <span id="pcdNormVal">1.0</span>
      <small>PCD power scaling (>1 = sharper peaks, <1 = flatter)</small>
    </div>
    
    <!-- TUNING NEEDLE SECTION -->
    <h4 style="margin:16px 0 8px 0; opacity:0.8; border-bottom:1px solid color-mix(in oklab, currentColor 20%, transparent); padding-bottom:4px;">üéØ Tuning Needle</h4>
    <div class="row">
      <label for="reactRange">Reactivity</label>
      <input id="reactRange" type="range" min="0.05" max="1.00" step="0.01" value="0.35">
      <span id="reactVal">0.35</span>
      <small>‚Üê smoother | snappier ‚Üí</small>
    </div>
    <div class="row">
      <label for="promRange">Min Prominence</label>
      <input id="promRange" type="range" min="0" max="24" step="0.5" value="6">
      <span id="promVal">6.0 dB</span>
      <small>peak prominence required to show needle</small>
    </div>
    <div class="row">
      <label for="rmsRange">Needle Min RMS</label>
      <input id="rmsRange" type="range" min="0" max="0.02" step="0.0005" value="0.003">
      <span id="rmsVal">0.0030</span>
      <small>minimum signal level for needle activation</small>
    </div>
    <div class="row">
      <label for="tunerMinRange">Needle Min Freq</label>
      <input id="tunerMinRange" type="range" min="40" max="150" step="5" value="70">
      <span id="tunerMinVal">70 Hz</span>
      <small>lowest frequency for tuning needle</small>
    </div>
    <div class="row">
      <label for="tunerMaxRange">Needle Max Freq</label>
      <input id="tunerMaxRange" type="range" min="800" max="3000" step="50" value="1800">
      <span id="tunerMaxVal">1800 Hz</span>
      <small>highest frequency for tuning needle</small>
    </div>
    
    <!-- DISPLAY SECTION -->
    <h4 style="margin:16px 0 8px 0; opacity:0.8; border-bottom:1px solid color-mix(in oklab, currentColor 20%, transparent); padding-bottom:4px;">üéµ Display</h4>
    <div class="row">
      <label for="noteNames">Note Names</label>
      <select id="noteNames" style="padding:8px; border-radius:8px; border:1px solid #888; background:transparent; color:currentColor; min-width:140px;">
        <option value="sharps">Sharps (C#, D#, F#, G#, A#)</option>
        <option value="flats">Flats (Db, Eb, Gb, Ab, Bb)</option>
        <option value="mixed">Mixed (C#/Db, D#/Eb, etc.)</option>
      </select>
      <small>how to display black keys</small>
    </div>
  </details>

  <div class="visualizations">
    <div class="vis-container">
      <canvas id="ring"></canvas>
    </div>
    <div class="vis-container">
      <div class="placeholder">
        <div>
          <div style="font-size: 2em; margin-bottom: 8px;">üöß</div>
          <div>Work in Progress</div>
          <div style="font-size: 0.8em; margin-top: 4px; opacity: 0.7;">Second visualization coming soon</div>
        </div>
      </div>
    </div>
  </div>

  <footer style="display:flex;gap:16px;align-items:center;flex-wrap:wrap">
    <div><strong>PCD (C..B):</strong> <code id="pcdText">[0,0,0,0,0,0,0,0,0,0,0,0]</code></div>
    <div id="tuneReadout" style="opacity:.9"></div>
  </footer>

<script type="module" src="script.js"></script>
</body>
</html>
